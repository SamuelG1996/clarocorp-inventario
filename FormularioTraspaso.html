<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Portal Inventario || Nueva Solicitud de Traspaso</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="menu-page">
  <div class="content">
    <a href="Traspaso.html" class="volver"><i class="fas fa-arrow-left"></i>Volver a Traspasos</a>

    <h2><i class="fas fa-sync-alt"></i> Nueva Solicitud de Traspaso</h2>

    <div class="tabla-datos">
      <table id="tablaSolicitud">
        <thead>
          <tr>
            <th>Código</th>
            <th>Descripción</th>
            <th>Cantidad</th>
            <th>Serie</th>
            <th>Lote</th>
            <th>UMB</th>
            <th>Almacén Origen</th>
            <th>Centro Origen</th>
            <th>Contrata que entrega</th>
            <th>Almacén Destino</th>
            <th>Centro Destino</th>
            <th>Contrata que recibe</th>
          </tr>
        </thead>
        <tbody id="tbodySolicitud">
          <tr>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="number" min="1" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
            <td><input type="text" required></td>
          </tr>
        </tbody>
      </table>
      <div class="acciones-tabla">
      <button onclick="agregarFila()"><i class="fas fa-plus-circle"></i> Agregar Fila</button>
      <button onclick="eliminarFila()"><i class="fas fa-minus-circle"></i> Eliminar Fila</button>
      </div>
    </div>

    <div class="campos-unicos">
      <label>Tipo de Material:<br>
      <select id="tipoMaterial" required>
        <option value="">Seleccionar</option>
        <option value="PINT">PINT</option>
        <option value="PEXT">PEXT</option>
      </select>
      </label>
     
      <label>Área Solicitante:<br>
      <input type="text" id="areaSolicitante" value="APROVISIONAMIENTO Y SOPORTE OPERATIVO" disabled required>
      </label>
      
      <label>Datos del Solicitante:<br>
      <input type="text" id="datosSolicitante" value="CLAUDIA HENRIQUEZ" disabled required>
      </label>
      
      <label>Guía de Remisión (PDF, JPG, PNG):<br><input type="file" id="guiaRemision" accept=".pdf,.jpg,.jpeg,.png" required></label>
    </div>
    <div class="acciones-tabla">
    <button onclick="guardarSolicitud()"><i class="fas fa-save"></i> Generar Solicitud</button>
    </div>
  </div>

  <script>
    function agregarFila() {
      const tbody = document.getElementById('tbodySolicitud');
      const row = tbody.rows[0].cloneNode(true);
      row.querySelectorAll('input, select').forEach(input => input.value = '');
      tbody.appendChild(row);
    }

    function eliminarFila() {
    const tbody = document.getElementById('tbodySolicitud');
    const filas = tbody.getElementsByTagName('tr');
    if (filas.length > 1) {
      tbody.removeChild(filas[filas.length - 1]);
    } else {
          Swal.fire({
      icon: 'info',
      title: 'No se puede eliminar',
      text: 'Debe haber al menos una fila en la tabla.',
      toast: true,
      position: 'bottom-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true,
      background: '#1e2022',
      color: '#ffffff',
      iconColor: '#f39c12'
    });
    }
  }

    function guardarSolicitud() {
      const tipoMaterial = document.getElementById("tipoMaterial").value;
      const areaSolicitante = document.getElementById("areaSolicitante").value;
      const datosSolicitante = document.getElementById("datosSolicitante").value;

      const filas = document.querySelectorAll("#tablaSolicitud tbody tr");

      filas.forEach(fila => {
        const datos = {
          codigo: fila.cells[0].querySelector('input').value,
          descripcion: fila.cells[1].querySelector('input').value,
          cantidad: fila.cells[2].querySelector('input').value,
          lote: fila.cells[3].querySelector('input').value,
          umb: fila.cells[4].querySelector('select').value,
          almacen_origen: fila.cells[5].querySelector('input').value,
          centro_origen: fila.cells[6].querySelector('input').value,
          contrata_entrega: fila.cells[7].querySelector('input').value,
          almacen_destino: fila.cells[8].querySelector('input').value,
          centro_destino: fila.cells[9].querySelector('input').value,
          contrata_recibe: fila.cells[10].querySelector('input').value,

          tipo_material: tipoMaterial,
          area_solicitante: areaSolicitante,
          datos_solicitante: datosSolicitante,
        };

        console.log(datos); // Aquí luego haces insert a Supabase
      });
    }

    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }
  </script>

  <script src="Js/Sesion.js"></script>
</body>
</html>





